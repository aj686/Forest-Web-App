<!-- sustainable.html -->
{% extends 'base.html' %}

{% block title %}Sustainable Table{% endblock %}

{% block header %}Sustainable Table{% endblock %}

{% block body %}
<div class="container mt-5">
    <p class="mb-5"></p>
    <h1>Sustainable Table</h1>
    <div class="table-responsive">
        <table class="table table-bordered table-striped">
            <thead class="thead-dark">
                <tr>
                    <th>Block X</th>
                    <th>Block Y</th>
                    <th>Tree Number</th>
                    <th>Production</th>
                    <th>Volume (m³)</th>
                    <th>Production after 30 years</th>
                    <th>Volume after 30 years (m³)</th>
                </tr>
            </thead>
            <tbody>
                {% for tree in cut_trees %}
                <tr>
                    <td>{{ tree.Block_X }}</td>
                    <td>{{ tree.Block_Y }}</td>
                    <td>{{ tree.Tree_Number }}</td>
                    <td>{{ tree.Production }}</td>
                    <td>{{ tree.Volume_m3 }}</td>
                    <td>{{ tree.Production_30 }}</td>
                    <td>{{ tree.Volume_after_30_years }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination controls -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if pagination.has_prev %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('sustainable', page=pagination.prev_num) }}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            {% endif %}
            
            {% for page_num in pagination.iter_pages() %}
            <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('sustainable', page=page_num) }}">{{ page_num }}</a>
            </li>
            {% endfor %}
            
            {% if pagination.has_next %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('sustainable', page=pagination.next_num) }}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
            {% endif %}
        </ul>
    </nav>

    <!-- Plotly Charts -->
    <div id="charts" class="mt-5">
        <div id="production-chart"></div>
        <div id="volume-chart"></div>
    </div>
</div>

<!-- Load Plotly.js -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
    // Prepare data for Production Chart
    var productionData = {
        x: [{% for tree in cut_trees %} "{{ tree.Tree_Number }}", {% endfor %}],
        y: [{% for tree in cut_trees %} {{ tree.Production }}, {% endfor %}],
        name: 'Initial Production',
        type: 'bar'
    };

    var production30Data = {
        x: [{% for tree in cut_trees %} "{{ tree.Tree_Number }}", {% endfor %}],
        y: [{% for tree in cut_trees %} {{ tree.Production_30 }}, {% endfor %}],
        name: 'Production after 30 years',
        type: 'bar'
    };

    var productionLayout = {
        title: 'Initial and After 30 Years Production',
        barmode: 'group'
    };

    var productionChart = [productionData, production30Data];

    // Render Production Chart
    Plotly.newPlot('production-chart', productionChart, productionLayout);

    // Prepare data for Volume Chart
    var volumeData = {
        x: [{% for tree in cut_trees %} "{{ tree.Tree_Number }}", {% endfor %}],
        y: [{% for tree in cut_trees %} {{ tree.Volume_m3 }}, {% endfor %}],
        name: 'Initial Volume',
        type: 'bar'
    };

    var volume30Data = {
        x: [{% for tree in cut_trees %} "{{ tree.Tree_Number }}", {% endfor %}],
        y: [{% for tree in cut_trees %} {{ tree.Volume_after_30_years }}, {% endfor %}],
        name: 'Volume after 30 years',
        type: 'bar'
    };

    var volumeLayout = {
        title: 'Initial and After 30 Years Volume',
        barmode: 'group'
    };

    var volumeChart = [volumeData, volume30Data];

    // Render Volume Chart
    Plotly.newPlot('volume-chart', volumeChart, volumeLayout);
</script>
{% endblock %}
